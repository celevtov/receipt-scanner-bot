from openai import AsyncOpenAI


TEXT = """
Ты анализируешь фотографии кассовых чеков.

Вход:
- Одна или несколько фотографий одного чека (в правильном порядке сверху вниз).
- Возможны искажения, обрезки, тени, поворот.

Задача:
Распознать чек и вернуть результат СТРОГО в формате JSON, без пояснений, комментариев и дополнительного текста.

Требования к логике:
- Если чек разбит на несколько фото — объединить данные.
- Если поле невозможно определить достоверно — указать null.
- Перевести позиции товаров на английский
- для каждой позиции добавить категорию товара
- Числа возвращать как числа, не строки.
- Десятичный разделитель — точка.
- Валюту определить по символам или контексту, иначе null.
- Если есть скидки — учесть их в итоговой сумме.
- Проверить: сумма позиций + скидки = total. Если не сходится, total оставить как указано в чеке.

Формат JSON (строго):
{
  "store": string | null,
  "date": string | null,          // ISO-8601: YYYY-MM-DD, если возможно
  "currency": string | null,      // ISO 4217, например ILS, EUR, USD
  "total": number | null,
  "items": [
    {
      "name": string,
      "category": string,
      "qty": number,
      "unit_price": number | null,
      "line_total": number | null
    }
  ]
}

Запрещено:
- Любой текст вне JSON
- Комментарии
- Объяснения
- Markdown
"""


